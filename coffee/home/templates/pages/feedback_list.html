{% extends 'layouts/base.html' %}
{% load static %}
{% load i18n %}
{% block content %}
  <div class="container-fluid py-2">
    <!-- Filter section -->
    <div class="filter-section mb-3">
      <form method="get" class="filter-form">
        <div class="row g-3">
          <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
            <label for="faculty" class="form-label small fw-medium">{% trans "Faculty" %}</label>
            <select name="faculty" id="faculty" class="form-select form-select-sm">
              <option value="">{% trans "All Faculties" %}</option>
              {% for f in faculties %}
                <option value="{{ f }}" {% if request.GET.faculty == f %}selected{% endif %}>{{ f }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
            <label for="study_programme" class="form-label small fw-medium">{% trans "Study Programme" %}</label>
            <select name="study_programme" id="study_programme" class="form-select form-select-sm">
              <option value="">{% trans "All Study Programmes" %}</option>
              {% for sp in study_programmes %}
                <option value="{{ sp }}"
                        {% if request.GET.study_programme == sp %}selected{% endif %}>{{ sp }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
            <label for="chair" class="form-label small fw-medium">{% trans "Chair" %}</label>
            <select name="chair" id="chair" class="form-select form-select-sm">
              <option value="">{% trans "All Chairs" %}</option>
              {% for c in chairs %}
                <option value="{{ c }}" {% if request.GET.chair == c %}selected{% endif %}>{{ c }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
            <label for="term" class="form-label small fw-medium">{% trans "Term" %}</label>
            <select name="term" id="term" class="form-select form-select-sm">
              <option value="">{% trans "All Terms" %}</option>
              {% for t in terms %}
                <option value="{{ t }}" {% if request.GET.term == t %}selected{% endif %}>{{ t }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
            <label for="course_name" class="form-label small fw-medium">{% trans "Course Name" %}</label>
            <select name="course_name" id="course_name" class="form-select form-select-sm">
              <option value="">{% trans "All Courses" %}</option>
              {% for cn in course_names %}
                <option value="{{ cn }}"
                        {% if request.GET.course_name == cn %}selected{% endif %}>{{ cn }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 d-flex align-items-end">
            <button type="submit" class="btn btn-primary btn-sm w-100">
              <i class="fas fa-filter me-1"></i>{% trans "Filter" %}
            </button>
          </div>
        </div>
      </form>
    </div>
    <!-- Feedback cards section -->
    <div class="feedback-grid">
      <div class="row g-4">
        {% for feedback in feedbacks %}
          <div class="col-xl-4 col-lg-6 col-md-6 d-flex">
            <div class="card feedback-task-card h-100 w-100">
              <div class="card-body d-flex flex-column">
                <div class="card-header-info mb-3">
                  <h5 class="card-title mb-2">{{ feedback.task.title }}</h5>
                  <div class="task-meta-compact text-muted small">
                    <span class="meta-item">
                      <i class="fas fa-university me-1"></i>{{ feedback.course.chair }}
                    </span>
                    <span class="meta-separator">•</span>
                    <span class="meta-item">
                      <i class="fas fa-book me-1"></i>{{ feedback.course.course_name }}
                    </span>
                    <span class="meta-separator">•</span>
                    <span class="meta-item">
                      <i class="fas fa-calendar me-1"></i>{{ feedback.course.term }}
                    </span>
                  </div>
                </div>
                
                <div class="card-content flex-grow-1 mb-3">
                  <p class="card-text text-muted small">
                    {{ feedback.task.description|slice:":150" }}
                    {% if feedback.task.description|length > 150 %}...{% endif %}
                  </p>
                </div>
                
                <div class="card-actions mt-auto">
                  <a href="{% url 'feedback' feedback.id %}"
                     class="btn btn-primary btn-sm w-100">
                    <i class="fas fa-play me-2"></i>{% trans "Start Task" %}
                  </a>
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="col-12">
            <div class="empty-state text-center py-5">
              <div class="empty-icon mb-3">
                <i class="fas fa-search fa-3x text-muted"></i>
              </div>
              <h5 class="text-muted">{% trans "No tasks available" %}</h5>
              <p class="text-muted">{% trans "Try adjusting your filters to find more tasks" %}</p>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% include 'includes/footer.html' %}
{% endblock %}
